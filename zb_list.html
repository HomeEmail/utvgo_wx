<!DOCTYPE html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<meta name="renderer" content="webkit"><!-- 国产双核浏览器，启用极速模式 -->
	<meta name="HandheldFriendly" content="true" />
	<meta name="MobileOptimized" content="320" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0" />
	<meta name="description" content="" />
	<meta name="author" content="" />
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta http-equiv="Pragma" content="no-cache">
	<meta http-equiv="Expires" content="-1">
	
	<meta http-equiv="Cache-Control" content="no-transform">
	<meta charset="utf-8">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-touch-fullscreen" content="yes">
	<meta name="full-screen" content="yes">
	<meta name="screen-orientation" content="portrait">
	<meta name="x5-fullscreen" content="true">
	<meta name="360-fullscreen" content="true">
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="mobile-web-app-capable" content="yes" />
	<meta name="apple-mobile-web-app-status-bar-style" content="black" />
	<meta name="mobile-web-app-status-bar-style" content="black" />
	<meta name="apple-touch-fullscreen" content="yes"/>
	<meta name="touch-fullscreen" content="yes"/>
	
    <title>直播</title>
    <link rel="stylesheet" href="./res/css/base.css" />
    <link rel="stylesheet" href="./res/css/idangerous.swiper.css" />
    <link rel="stylesheet" href="./res/css/main.css" />
    <link rel="stylesheet" href="./res/css/zb_list.css" />
    <style type="text/css">

    </style>
    <script type="text/javascript">

    
    </script>
</head>
<body style="" class="overflow-scroll-y">
	<div id="sideMenu" class="overflow-scroll-y">
		<div class="search-wrapper">
			<div type="text" id="searchInput">请输入关键词</div>
		</div>
		<div class="sideMenu-list-wrapper clearfix">
			<a href="index.html" class="menuItem">
				<img src="./res/images/home@2x.png">
				<p>推荐</p>
			</a>
			<a href="zb_list.html" class="menuItem">
				<img src="./res/images/liveplay_icon@2x.png">
				<p>直播</p>
			</a>
			<a href="db_index.html" class="menuItem">
				<img src="./res/images/db_icon@2x.png">
				<p>点播</p>
			</a>
			<a href="#" class="menuItem">
				<img src="./res/images/broadcast_icon@2x.png">
				<p>广播</p>
			</a>
			<!-- <a href="#" class="menuItem">
				<img src="./res/images/shopping_icon@2x.png">
				<p>购物</p>
			</a> -->
			<a href="http://m.maizuo.com/" class="menuItem">
				<img src="./res/images/ticket_icon@2x.png">
				<p>电影票</p>
			</a>
			<a href="#" class="menuItem">
				<img src="./res/images/usercenter_icon@2x.png">
				<p>个人中心</p>
			</a>
			<a href="qd_list.html" class="menuItem">
				<img src="./res/images/qd_icon@2x.png">
				<p>强档</p>
			</a>
			<a href="sp_list.html" class="menuItem">
				<img src="./res/images/zq_icon@2x.png">
				<p>专区</p>
			</a>
			<a href="dy_list.html?channelId=2" class="menuItem">
				<img src="./res/images/movie_icon@2x.png">
				<p>电影</p>
			</a>
			<a href="dy_list.html?channelId=3" class="menuItem">
				<img src="./res/images/dsj_icon@2x.png">
				<p>剧集</p>
			</a>
			<a href="dy_list.html?channelId=7" class="menuItem">
				<img src="./res/images/dm_icon@2x.png">
				<p>动漫</p>
			</a>
			<!-- <a href="#" class="menuItem">
				<img src="./res/images/car_icon@2x.png">
				<p>汽车</p>
			</a>
			<a href="#" class="menuItem">
				<img src="./res/images/card_icon@2x.png">
				<p>贺卡</p>
			</a>
			<a href="#" class="menuItem">
				<img src="./res/images/39health_icon@2x.png">
				<p>39健康</p>
			</a> -->
		</div>
	</div>
	<div id="main" class="overflowHidden">
	    <div class="main-header">
	        <button id="menuBt"></button>
	        <button id="meBt"></button>
	    </div>
	    <div class="listTypeBox">
		    <div id="swiper-container1" class="swiper-container">
		        <ul id="typeList" class="listType-type swiper-wrapper">
		<!--             <li class="listType-item swiper-slide ">粤语台<i></i>
		            </li> -->
		        </ul>
		    </div>
	    </div>
	    <div class="tvlistbox">
		    <div id="swiper-container2" class="swiper-container">
		        <ul id="container2Wrapper" class="swiper-wrapper">
		<!--             <li id="" class="indexContentBox swiper-slide overflow-scroll-y">
		                <div class="zb-item">
		                    <a href="#" class="zb-item-link clearfix">
		                        <div class="zb-item-logo" style="background-image:url();"></div>
		                        <div class="zb-item-text">
		                            <p class="zb-item-name ellipsis">佛山电视台</p>
		                            <p class="zb-item-now ellipsis">19:00 转播中央台新闻联播</p>
		                            <p class="zb-item-next ellipsis">财富前途</p>
		                        </div>
		                        <div class="zb-item-icon"></div>
		                    </a>
		                </div>
		            </li> -->
		        </ul>
		    </div>
	    </div>
	</div>

	<div class="loadingTip"><div class="loadingTipImg"></div></div>


	<script type="text/javascript" src="./res/js/lib/zepto-1.1.6.js"></script>
	<script type="text/javascript" src="./res/js/lib/fx.js"></script>
	<script type="text/javascript" src="./res/js/lib/fx_methods.js"></script>
	<script type="text/javascript" src="./res/js/lib/idangerous.swiper.js"></script>

	<script type="text/javascript" src="./res/js/main.js"></script>
	<script type="text/javascript">
$(document).ready(function () {
	showLoading()
	getTvTypes();
})
function loadTVlistByType(swiper){
	var i=swiper.activeIndex;
	var typeid=$('#typeList .swiper-slide').eq(i).attr('data-id');
	var $el=$('#container2Wrapper .swiper-slide').eq(i);
	if($el.html().indexOf('暂无数据')>-1){
		showLoading();
		$.ajax({
		  type: 'GET',
		  url: serverAddress+'/utvgoClient/interfaces/tvShow_listTvCollectList.action?pageNo=1&pageSize=10000&channel='+typeid+'&province=',
		  // data to be added to query string:
		  //data: {},
		  // type of data we are expecting in return:
		  dataType: 'json',
		  success: function(data){
		  	hideLoading();
		  	if (data.status==0) {
		  		var _data=data.result;
		  		var s='';
		  		var item;
			    for(var i=0,len=_data.length;i<len;i++){
			    	item=_data[i];
			    	s+='<div class="zb-item"> <a href="./zb_listShow.html?playName='+encodeURIComponent(item.tvName)+'&playUrl='+encodeURIComponent(item.playUrl)+'&playImg='+encodeURIComponent('')+'&contentId='+encodeURIComponent(item.id)+'&col=2&type='+encodeURIComponent("tv")+'" class="zb-item-link clearfix"> <div class="zb-item-logo" style="background-image:url('+item.img+');"></div> <div class="zb-item-text"> <p class="zb-item-name ellipsis">'+item.tvName+'</p> <p class="zb-item-now ellipsis">'+item.showTime+' '+(!!item.showName?item.showName:'暂无节目名称')+'</p> <p class="zb-item-next ellipsis">'+item.nextShowTime+' '+(!!item.nextShowName?item.nextShowName:'暂无节目预告')+'</p> </div> <div class="zb-item-icon"></div>'+(item.isOpen?'':'<div class="zb-nolimitTime-icon"></div>')+'</a> </div> ';
			    }
			    if(_data.length<=0){
			    	s+='<div class="noDtataTips">暂无数据</div>';
			    }
			    $el.html(s);
		  	};

		  },
		  error: function(xhr, type){
		    //alert('network error!');
		    hideLoading();
		  }
		});
	}
}
function initSwiper(){
	var Swiper1 = new Swiper('#swiper-container1',{
        paginationClickable: !0,
        slidesPerView: "auto",
        freeMode: !0  
		// ,onTouchStart: function(swiper, even){
		//  	$(".listType-item.on").removeClass("on");
		//  	$(".listType-item").eq(Swiper1.activeIndex).addClass("on");	
		//  	Swiper2.swipeTo(Swiper1.activeIndex,1000,false);			
		//      console.log(swiper);
		//     }
		
	})
	var Swiper2 = new Swiper('#swiper-container2',{
        paginationClickable: !0,
        //slidesPerView: "auto",
        //freeMode: !0 ,  
		onSlideChangeEnd: function(swiper, even){
		 	$(".listType-item.on").removeClass("on");
		 	$(".listType-item").eq(Swiper2.activeIndex).addClass("on");
		 	Swiper1.swipeTo(Swiper2.activeIndex,200,false);	
		 	loadTVlistByType(swiper);
	 	},
	 	onFirstInit : function(swiper,event){
	 		loadTVlistByType(swiper);
	 	}
	})
	// Swiper1.params.control = Swiper2;//需要在Swiper2初始化后，Swiper1控制Swiper2
	// Swiper2.params.control = Swiper1;//需要在Swiper1初始化后，Swiper2控制Swiper1
	$(".listType-item").eq(Swiper2.activeIndex).addClass("on");

	$("#swiper-container1").on("tap",".listType-item",function(){
	 	var _this=$(this);
	 	$(".listType-item.on").removeClass("on");
	 	_this.addClass("on");
	 	Swiper2.swipeTo(_this.index(),300,false);
	});	
	// $("#swiper-container2").on("swipe",function(){
	//  	var _this=$(this);
	//  	$(".listType-item.on").removeClass("on");
	//  	$(".listType-item").eq(Swiper2.activeIndex).addClass("on");
	// });		
}
function getTvTypes(){
	req=$.ajax({
	  type: 'GET',
	  url: serverAddress+'/utvgoClient/appAPI/GetFilterWordsNew.jsp?channelId=0',
	  // data to be added to query string:
	  data: {},
	  // type of data we are expecting in return:
	  dataType: 'json',
	  success: function(data){
  		var _data=data.result.tvjson.types||[];
	  	if (data.status==0) {};
	  	getTvList(_data);
	  },
	  error: function(xhr, type){
	    //alert('network error!');
	  }
	});

}

function getTvList(typeArr){
	$.ajax({
	  type: 'GET',
	  url: serverAddress+'/utvgoClient/interfaces/tvShow_listTvCollectList.action?pageNo=1&pageSize=10000&channel=&province=',
	  // data to be added to query string:
	  data: {},
	  // type of data we are expecting in return:
	  dataType: 'json',
	  success: function(data){
	  	if (data.status==0) {
	  		var _data=data.result;
		    renderTVs(typeArr,_data);	  		
	  	};

	  },
	  error: function(xhr, type){
	    //alert('network error!');
	  }
	});
}

function renderTVs(typeArr,listArr){
	var _typeArr=typeArr;
	var _listArr=listArr;
	var tvListObt={};
	var s='';
	var item={};
	var typeStr="";
	var listStr="";
	tvListObt["all"]="";
    for(var i=0,_listLen=_listArr.length;i<_listLen;i++){
    	item=_listArr[i];
    	s='<div class="zb-item"> <a href="./zb_listShow.html?playName='+encodeURIComponent(item.tvName)+'&playUrl='+encodeURIComponent(item.playUrl)+'&playImg='+encodeURIComponent('')+'&contentId='+encodeURIComponent(item.id)+'&col=2&type='+encodeURIComponent("tv")+'" class="zb-item-link clearfix"> <div class="zb-item-logo" style="background-image:url('+item.img+');"></div> <div class="zb-item-text"> <p class="zb-item-name ellipsis">'+item.tvName+'</p> <p class="zb-item-now ellipsis">'+item.showTime+' '+(!!item.showName?item.showName:'暂无节目名称')+'</p> <p class="zb-item-next ellipsis">'+item.nextShowTime+' '+(!!item.nextShowName?item.nextShowName:'暂无节目预告')+'</p> </div> <div class="zb-item-icon"></div>'+(item.isOpen?'':'<div class="zb-nolimitTime-icon"></div>')+'</a> </div> ';
	    	if (!!!tvListObt[""+item.channel]) {
	    		tvListObt[""+item.channel]="";
	    	};
    		tvListObt[""+item.channel]+=s;
    		tvListObt["all"]+=s;
    };
	for (var j = 0,_typeLen=typeArr.length; j < _typeLen; j++) {
		if(!!!_typeArr[j].name){
			continue;
		}
		typeStr=typeStr+'<li class="listType-item swiper-slide " data-id="'+_typeArr[j].id+'"><span>'+ (_typeArr[j].name||"--")+'</span><!--<i></i> --></li>'; 
		if (tvListObt[""+_typeArr[j].id]) {
        	 listStr+='<li id="" class="indexContentBox swiper-slide overflow-scroll-y">'+tvListObt[""+_typeArr[j].id]+'</li>';
        }else{
        	listStr+='<li id="" class="indexContentBox swiper-slide overflow-scroll-y"><div class="noDtataTips">暂无数据</div></li>';
        };
        if (j==_typeLen-1) {
        		typeStr+='<li class="listType-item swiper-slide "><span>全部</span><!--<i></i>--> </li>'; 
        		listStr+='<li id="" class="indexContentBox swiper-slide overflow-scroll-y">'+tvListObt["all"]+'</li>';
        }; 
	};

	$("#typeList").html(typeStr);
    $('#container2Wrapper').html(listStr);
    initSwiper();
	hideLoading()
}
	


	</script>
</body>


</html>
