function getTypeData(){var e=serverAddress+"/utvgoClient/interfaces/consoc_listContent.action";supplierId||(e=serverAddress+"/utvgoClient/interfaces/hdtvContent_typeContext.action"),$.ajax({type:"GET",url:e,data:{supplierId:supplierId,channelId:channelId,pageSize:pageSize,pageNo:pageNo,publishYear:yearId,typeId:typeId,areaId:areaId},dataType:"json",success:function(e){hideLoading(),renderTypeData(e),ajaxMore||(supplierId?renderListData(e.result.contents,"new"):getNewData("new"))},error:function(e,t){}})}function renderTypeData(e){var t="",i=[],a=0,n=0,s="",p="";if(t+='<div id="listType-type" class="listType-row listType-type swiper-container"><div class="swiper-wrapper">',i=e.result.channels||[],supplierId||(i=e.result.dyTypes||[]),a=0,n=i.length,supplierId)for(t+='<div class="swiper-slide listType-item on" data-id="0"><div class="listType-item-text">全部类型</div></div>';n>a;a++)s=i[a].name,t+='<div class="swiper-slide listType-item" data-id="'+i[a].id+'"><div class="listType-item-text">'+s+"</div></div>";else for(;n>a;a++)s=i[a].typeName,p=0==i[a].typeId?"on":"",t+='<div class="swiper-slide listType-item '+p+'" data-id="'+i[a].typeId+'"><div class="listType-item-text">'+s+"</div></div>";t+="</div></div>",$("#listTypeBox").html(t),t=t.replace('id="listType-type"','id="listType-type-fixed"'),$("#listTypeBoxFixed").html(t),initListTypeSwiper(),initListTypeEvent()}function initListTypeEvent(){$(".listType-type .listType-item").on("tap",function(e){supplierId?channelId=$(this).attr("data-id"):typeId=$(this).attr("data-id"),typeName=$(this).children().html(),$(".listType-type .listType-item.on").removeClass("on"),$("#listType-type .listType-item").eq($(this).index()).addClass("on"),$("#listType-type-fixed .listType-item").eq($(this).index()).addClass("on");try{ajaxMore.abort()}catch(t){}getNewData("new"),setListTypeSelectedBox()})}function setListTypeSelectedBox(){$(".listTypeSelectedBox").html("当前选择: "+typeName)}function getNewData(e){var e=e||"new";"new"==e?pageNo=1:pageNo++,"new"==e&&showLoading();var t=serverAddress+"/utvgoClient/interfaces/consoc_listContent.action";supplierId||(t=serverAddress+"/utvgoClient/interfaces/content_listContent.action"),ajaxMore=$.ajax({type:"GET",url:t,data:{supplierId:supplierId,channelId:channelId,pageSize:pageSize,pageNo:pageNo,publishYear:yearId,typeId:typeId,areaId:areaId},dataType:"json",success:function(t){hideLoading(),renderListData(supplierId?t.result.contents:t.result,e)},error:function(e,t){ajaxMore=null}})}function renderListData(e,t){for(var i="",e=e||[],a=0,n=e.length;n>a;a++)i+='<div class="commonList-item"> <a data-remark="'+e[a].remark+'" data-href="./play_sn.html?playName='+encodeURIComponent(e[a].name)+"&playUrl="+encodeURIComponent(e[a].playUrl)+"&playImg="+encodeURIComponent(e[a].img)+"&contentId="+encodeURIComponent(e[a].contentId)+"&col="+(e[a].mediaNumber>1?3:2)+"&type="+encodeURIComponent(e[a].type||"content")+"&mediaNumber="+encodeURIComponent(e[a].mediaNumber)+'" class="commonList-item-link clearfix"> <div class="commonList-item-img"> <img src="'+e[a].img+'" /> </div> <div class="commonList-item-text-wrapper"> <p class="commonList-item-text">'+e[a].name+'</p> <span class="commonList-item-type-text">'+e[a].type+"</span> </div> </a> </div>";t&&"new"!=t?$("#listContentBox").append(i):$("#listContentBox").html(i),$(".nomore").length>0?$(".nomore").hide():$("#listContent").append('<div class="nomore">正在加载...</div>'),e.length<pageSize?($(".nomore").show().html("没有更多了!"),ajaxMore=!0):ajaxMore=null}function updateListTypeFixedSwiper(){listTypeTypeFixed.reInit()}function initListTypeSwiper(){listTypeType=new Swiper("#listType-type",{paginationClickable:!0,slidesPerView:"auto",freeMode:!0}),listTypeTypeFixed=new Swiper("#listType-type-fixed",{paginationClickable:!0,slidesPerView:"auto",freeMode:!0})}$(".list-page-main").on("scroll",function(e){var t=$(this),i=t.scrollTop(),a=t.height();if(54>=i?($(".listTypeBox").show(),$(".listTypeBox.fixed").hide(),$(".listTypeSelectedBox").hide()):($(".listTypeBox").hide(),$(".listTypeSelectedBox").show()),i+a-46+5>=$("#listContent").height()){if(ajaxMore)return;$(".nomore").length>0?$(".nomore").show().html("正在加载..."):$("#listContent").append('<div class="nomore">正在加载...</div>'),getNewData("more")}});var ajaxMore=null;$(".listTypeSelectedBox").on("tap",function(e){e.stopPropagation(),e.preventDefault(),e.stopImmediatePropagation(),$(this).hide(),$(".listTypeBox.fixed").show(),updateListTypeFixedSwiper()});var channelId,pageNo,typeId,areaId,yearId,pageSize,supplierId,spName,channelName,urlParaObj=getUrlPara();channelId=urlParaObj.channelId||"",supplierId=urlParaObj.supplierId||"",spName=urlParaObj.spName||"",channelName=urlParaObj.channelName||"",pageNo=1,typeId=0,areaId=0,yearId=0,pageSize=10;var typeName="全部类型";parseInt(supplierId,10)>0?$(".topNav-title").html(spName):$(".topNav-title").html(channelName),getTypeData(),$("#listContentBox").on("tap",".commonList-item-link",function(e){var t=$(this).attr("data-remark");try{localStorage.setItem("videoRemark",t)}catch(i){}window.location.href=$(this).attr("data-href")});var listTypeType,listTypeTypeFixed;