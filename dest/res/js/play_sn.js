function urlParaInit(e){urlParaObj=getUrlPara(e||""),type=urlParaObj.type||"",col=urlParaObj.col||"2",playUrl=urlParaObj.playUrl||"",playImg=urlParaObj.playImg||"",playName=urlParaObj.playName||"",mediaNumber=urlParaObj.mediaNumber||1,contentId=urlParaObj.contentId||0,channelId=urlParaObj.channelId||0,boxId=urlParaObj.boxId||0,currentIndex=urlParaObj.currentIndex||0,col>2&&(duojiType="ji"),"qd"!=type&&"qi"!=type||(duojiType="qi",col=3),isDuoji=!1,col>2&&(isDuoji=!0)}function addRecord(e,t,a,i,o,n,d,r){var l={contentId:i,contentName:t,remark:t,playUrl:e,mediaNum:d||1,tvgoImg:a,type:n,boxId:o,channelId:r},c=localStorage.getItem("recordList")||"";c=c?JSON.parse(c):[];for(var s=0,m=c.length;s<m;s++)if(i==c[s].contentId)return;c.length>20&&c.pop(),c.unshift(l),localStorage.setItem("recordList",JSON.stringify(c))}function getLikeList(){showLoading();var e=0,t=10,a=1,i=0,o=0,n=0,d=serverAddress+"/utvgoClient/tvutvgo/channel/ajaxList.action";$.ajax({type:"GET",url:d,data:{channelId:channelId,pagesize:t,"pager.offset":e,pageNo:a,year:i,typeId:n,areaId:o},dataType:"json",success:function(e){hideLoading(),e&&e.pm&&renderLikeList(e.pm.records||[])},error:function(e,t){hideLoading()}})}function renderLikeList(e){var t="",a=e||[],i="";likeDataList=a;for(var o=0,n=a.length;o<n;o++)a[o].tvgoImg.indexOf("http://")==-1&&(a[o].tvgoImg=imgBasePath+a[o].tvgoImg),a[o].id!=boxId&&(i="./play_sn.html?playName="+encodeURIComponent(a[o].contentName)+"&playUrl="+encodeURIComponent(a[o].playUrl||a[o].tvgoPlayurl)+"&playImg="+encodeURIComponent(a[o].tvgoImg)+"&currentIndex=0&boxId="+a[o].id+"&channelId="+a[o].channelId+"&contentId="+encodeURIComponent(a[o].contentId)+"&col="+(a[o].mediaNum>1?3:2)+"&type="+encodeURIComponent(type)+"&mediaNumber="+encodeURIComponent(a[o].mediaNum),t+='<div class="rdzx-item"> <a data-boxid="'+a[o].id+'" data-href="'+i+'" class="rdzx-item-link"><img src="'+a[o].tvgoImg+'" /> <p class="rdzx-text">'+a[o].contentName+"</p></a> </div>");$("#likeListBox").html(t),$("#likeListBox .rdzx-item-link").on("tap",function(e){$(".video-play-play-icon").hide(),$(".video-play-img").hide(),isDuoji&&"ji"==duojiType?($(".detail-jiList-item").off(),getDetailNew($(this).attr("data-boxid"))):"qi"==duojiType?getDetailNew($(this).attr("data-boxid")):window.location.replace($(this).attr("data-href"))}),"qi"!=type?setTimeout(function(){var e=$(".rdzx-item-link").width();if(e){var t=e/.75;$(".rdzx-item-link img").height(t)}},0):setTimeout(function(){var e=$(".rdzx-item-link").width();if(e){var t=e/(210/158);$(".rdzx-item-link img").height(t)}},0)}function getDetailNew(e){var t="",a=serverAddress+"/utvgoClient/tvutvgo/channel/ajaxDetail.action";showLoading(),$.ajax({type:"GET",url:a,data:{channelId:channelId,boxId:e,zoneId:17,pagesize:1e3},dataType:"json",success:function(e){if(hideLoading(),e.pm.records.length>0){var a=e.pm.records[0];a.tvgoImg.indexOf("http://")==-1&&(a.tvgoImg=imgBasePath+a.tvgoImg),t="./play_sn.html?playName="+encodeURIComponent(a.contentName)+"&playUrl="+encodeURIComponent(a.playUrl||a.tvgoPlayurl)+"&playImg="+encodeURIComponent(a.tvgoImg)+"&currentIndex=0&boxId="+e.snet_ContentBox.id+"&channelId="+a.channelId+"&contentId="+encodeURIComponent(a.contentId)+"&col="+(e.snet_ContentBox.mediaNum>1?3:2)+"&type="+encodeURIComponent(type)+"&mediaNumber="+encodeURIComponent(e.snet_ContentBox.mediaNum),"qi"==type?localStorage.setItem("playList",JSON.stringify(e.pm.records)):localStorage.setItem("duojiDatas",JSON.stringify(e.pm.records))}else{var a=e.snet_ContentBox;a.tvgoImg.indexOf("http://")==-1&&(a.tvgoImg=imgBasePath+a.tvgoImg),t="./play_sn.html?playName="+encodeURIComponent(a.contentName)+"&playUrl="+encodeURIComponent(a.playUrl||a.tvgoPlayurl)+"&playImg="+encodeURIComponent(a.tvgoImg)+"&currentIndex=0&boxId="+a.id+"&channelId="+a.channelId+"&contentId="+encodeURIComponent(a.contentId)+"&col="+(a.mediaNum>1?3:2)+"&type="+encodeURIComponent(type)+"&mediaNumber="+encodeURIComponent(a.mediaNum)}window.location.replace(t)},error:function(e,t){}})}function getDuojiList(e){var t=localStorage.getItem("duojiDatas")||"";if(t){try{localStorage.setItem("duojiDatas","")}catch(a){}t=JSON.parse(t),renderDuojiList(t)}else{showLoading();var i=serverAddress+"/utvgoClient/tvutvgo/channel/ajaxContentList.action";$.ajax({type:"GET",url:i,data:{boxId:e,pagesize:1e3},dataType:"json",success:function(e){hideLoading(),e.pm.records.length>0&&(renderDuojiList(e.pm.records||[]),currentIndex=0,$(".detail-jiList-item").eq(currentIndex).trigger("tap"))},error:function(e,t){hideLoading()}})}}function renderDuojiList(e){for(var t=e||[],a="",i=0,o=t.length;i<o;i++)t[i].tvgoImg.indexOf("http://")==-1&&(t[i].tvgoImg=imgBasePath+t[i].tvgoImg),a+='<a data-playurl="'+(t[i].playUrl||t[i].tvgoPlayurl)+'" data-img="'+t[i].tvgoImg+'" title="'+t[i].contentName+'" class="detail-jiList-item">'+t[i].recommendContentName+"</a>";t.length<=0&&(a='<div style="text-align: center;line-height: 50px;color: #fff;">无数据!</div>'),$("#duojiListBox").html(a),$(".detail-jiList-item").off(),$(".detail-jiList-item").on("tap",function(e){var t=$(this),a=t.index();currentIndex=a;var i=t.attr("data-playurl"),o=(t.attr("title"),t.attr("data-img"));setVideoInfo(i,o),document.getElementById("videoView").play(),$(".detail-jiList-item.on").removeClass("on"),t.addClass("on"),$(".video-play-play-icon").hide(),$(".video-play-img").hide()}),$(".detail-jiList-item").eq(currentIndex).addClass("on")}function playDuojiNext(){var e="ji"==duojiType?duojiDataList.length:qiDataList.length;currentIndex+1>=e||("ji"==duojiType?$(".detail-jiList-item").eq(++currentIndex).trigger("tap"):$(".commonList-item").eq(++currentIndex).trigger("tap"))}function getQiList(e){var t=localStorage.getItem("playList")||"";try{localStorage.setItem("playList","")}catch(a){}if(t)qiDataList=JSON.parse(t),renderQiList();else{showLoading();var i=serverAddress+"/utvgoClient/tvutvgo/channel/ajaxContentList.action";$.ajax({type:"GET",url:i,data:{boxId:e,pagesize:1e3},dataType:"json",success:function(e){hideLoading(),qiDataList=e.pm.records,renderQiList(),e.pm.records.length>0&&(currentIndex=0,$(".commonList-item").eq(currentIndex).trigger("tap"))},error:function(e,t){hideLoading()}})}}function renderQiList(){for(var e=qiDataList||[],t="",a=0,i=e.length;a<i;a++)e[a].tvgoImg.indexOf("http://")==-1&&(e[a].tvgoImg=imgBasePath+e[a].tvgoImg),t+='<div class="commonList-item" data-remark="'+e[a].remark+'" data-playurl="'+(e[a].playUrl||e[a].tvgoPlayurl)+'" data-img="'+e[a].tvgoImg+'" title="'+(e[a].recommendContentName||e[a].contentName)+'"><a class="commonList-item-link clearfix"> <div class="commonList-item-img"> <img src="'+e[a].tvgoImg+'" /> </div> <div class="commonList-item-text-wrapper"> <p class="commonList-item-text">'+(e[a].recommendContentName||e[a].contentName)+'</p> <span class="commonList-item-type-text"><!--'+e[a].createTime.split(" ")[0]+"&nbsp;&nbsp;&nbsp;-->"+e[a].typeName+"</span> </div> </a> </div>";e.length<=0&&(t='<div style="text-align: center;line-height: 50px;color: #fff;">无数据!</div>'),$("#duojiListBox").html(t),$(".commonList-item").off(),$(".commonList-item").on("tap",function(e){var t=$(this),a=t.index();currentIndex=a,duojiType="qi",col=3,isDuoji=!0;var i=t.attr("data-playurl"),o=t.attr("title"),n=t.attr("data-img");setVideoInfo(i,n),document.getElementById("videoView").play(),setVideoTitle(o),setVideoIntroduce(t.attr("data-remark")),$(".video-play-play-icon").hide(),$(".video-play-img").hide()})}function renderDetailTab(){var e="";e+='<div class="detailTabBar col'+col+' clearfix">',3==col&&(e+='<div class="detailTabItem on"> <span class="detailTab-text">选集</span> </div>'),e+='<div class="detailTabItem"> <span class="detailTab-text">猜你喜欢</span> </div> <div class="detailTabItem"> <span class="detailTab-text">简介</span> </div>',e+="</div>",e+='<div class="detailTabContentBox overflow-scroll-y">',3==col&&(e+='<div id="duojiListBox" class="detailTabItemContent detail-jiList clearfix">  </div>'),e+='<div id="likeListBox" class="detailTabItemContent indexContentBox clearfix"> </div> <div id="videoIntroduceBox" class="detailTabItemContent"> </div>',e+="</div>",$(".detailTabBox").each(function(t,a){$(a).html(e)}),detailTabInitShow()}function init(){setVideoTitle(playName),setVideoInfo(playUrl,playImg),isDuoji&&"ji"==duojiType&&getDuojiList(boxId),getLikeList(),setVideoIntroduce(localStorage.getItem("videoRemark")||playName);try{localStorage.setItem("videoRemark","")}catch(e){}document.getElementById("videoView").addEventListener("ended",function(e){isDuoji&&playDuojiNext()}),document.getElementById("videoView").addEventListener("error",function(e){alert("视频加载失败!")}),"qi"==duojiType&&getQiList(boxId)}function setVideoInfo(e,t){playUrl&&(document.getElementById("videoView").src=e),t&&$(".video-play-img").css("background-image","url("+t+")")}function setVideoIntroduce(e){var t='<div class="detail-profile"> <p>'+e.replace("\r\n","</p><p>")+"</p></div>";$("#videoIntroduceBox").html(t)}function setVideoTitle(e){document.title=e,$(".video-play-title").html(e)}var urlParaObj=getUrlPara(),contentId=0,channelId=0,type="",col=2,playUrl="",playImg="",playName="",mediaNumber=1,boxId=0,qiDataList=[],likeDataList=[],duojiDataList=[],currentIndex=0,isDuoji=!1,duojiType="";$(".video-play-wrapper").one("touchstart",function(e){$(".video-play-play-icon").hide(),$(".video-play-img").hide(),document.getElementById("videoView").play(),addRecord(playUrl,playName,playImg,contentId,boxId,type,mediaNumber,channelId)}),$(".video-top-bar-back").on("tap",function(e){window.history.back()}),isWeiXin()&&($(".video-top-bar").hide(),$(".video-play-wrapper").css("padding-top","0px")),urlParaInit(),renderDetailTab(),init();